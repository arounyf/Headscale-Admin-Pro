{
    admin off
    auto_https disable_redirects
    servers {
        protocols h1 h2
    }
}

:80 {
    encode gzip
    handle_path /.well-known/acme-challenge/* {
        file_server
    }

    reverse_proxy 127.0.0.1:5000 {
        transport http {
            versions h11 h2
        }
        header_up Host {host}
        header_up X-Real-IP {remote_addr}
        header_up X-Forwarded-For {remote_addr}
        header_up X-Forwarded-Proto {scheme}
    }
}

:81 {
    encode gzip

    handle_path /.well-known/acme-challenge/* {
        file_server
    }

    handle_path /admin* {
        reverse_proxy /admin* 127.0.0.1:5000 {
            transport http {
                versions h11 h2
            }
            header_up Host {host}
            header_up X-Real-IP {remote_addr}
            header_up X-Forwarded-For {remote_addr}
            header_up X-Forwarded-Proto {scheme}
        }
    }

    handle_path /register* {
        reverse_proxy /register* 127.0.0.1:5000 {
            transport http {
                versions h11 h2
            }
            header_up Host {host}
            header_up X-Real-IP {remote_addr}
            header_up X-Forwarded-For {remote_addr}
            header_up X-Forwarded-Proto {scheme}
        }
    }

    reverse_proxy 127.0.0.1:8080 {
        transport http {
            versions h11 h2
        }
        header_up Host {host}
        header_up X-Real-IP {remote_addr}
        header_up X-Forwarded-For {remote_addr}
        header_up X-Forwarded-Proto {scheme}
    }
}