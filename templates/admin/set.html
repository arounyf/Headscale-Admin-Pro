<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>系统设置</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/static/layui/css/layui.css" media="all">
  <link rel="stylesheet" href="/static/adminui/dist/css/admin.css" media="all">
</head>
<body>

  <div class="layui-fluid">
    <div class="layui-row layui-col-space15">
      <div class="layui-col-md8">
        <div class="layui-card">
          <div class="layui-card-header">系统设置</div>
          <div class="layui-card-body" pad15>
            
            <div class="layui-form" wid100 lay-filter="">


              <div class="layui-form-item">
                  <label class="layui-form-label">apiKey</label>

                  <div class="layui-input-inline" style="width:395px">
                    <input type="password" name="apiKey" lay-verify="required" autocomplete="off"   value="{{ apikey }}" class="layui-input" lay-affix="eye">
                  </div>
                  <div class="layui-form-mid" style="padding: 0!important;">
                    <button type="button" class="layui-btn layui-btn-primary" lay-on="get_apikey">自动生成</button>
                  </div>

               </div>


              <div class="layui-form-item">
                <label class="layui-form-label">server url</label>
                <div class="layui-input-block" style="width:500px">
                  <input type="text" name="serverUrl" lay-verify="required" value="{{ server_url }}" class="layui-input">
                </div>
              </div>

              <div class="layui-form-item">
                <label class="layui-form-label">网卡名</label>

{#                  <input type="text" name="serverNet" lay-verify="required"  value="{{ server_net }}" class="layui-input">#}
                    <div class="layui-input-inline" style="width:300px">
                      <select name="serverNet">
                        <option value=""></option>
{#                        <option value="0">写作</option>#}
{#                        <option value="1" selected>阅读</option>#}
{#                        <option value="2">游戏</option>#}
{#                        <option value="3">音乐</option>#}
{#                        <option value="4">旅行</option>#}
                          {{ server_net|safe }}
                      </select>
                    </div>



              </div>

              
              <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">服务器分布代码</label>
                <div class="layui-input-block">
                  <textarea name="regionHtml" class="layui-textarea"  lay-verify="required" >{{ region_html }}</textarea>
                </div>
              </div>


              <div class="layui-form-item">
                <div class="layui-input-block">
                  <button class="layui-btn" lay-submit lay-filter="set_config">确认保存</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


        <div class="layui-col-md4">
            <div class="layui-card layui-form" lay-filter="component-form-element">
          <div class="layui-card-header">headscale {{ version }}进程管理</div>
          <div class="layui-card-body layui-row layui-col-space10">

            <div class="layui-col-md12">
              <input type="checkbox" name="zzz" lay-skin="switch" lay-text="开启|关闭" title="开启|关闭" lay-filter="switch_up" {{ headscale_status }}><div class="layui-unselect layui-form-switch" lay-skin="switch"><div>关闭</div><i></i></div>
            </div>

          </div>
        </div>
        </div>




    </div>
  </div>

  <script src="/static/layui/layui.js"></script>


<script>
layui.use(function(){
  var form = layui.form;
  var layer = layui.layer;
  var $ = layui.$;
  var util = layui.util;
  // 普通事件
  util.on('lay-on', {
    // 获取验证码
    'get_apikey': function(othis){
       $.ajax({
          url:'/api/set/get_apikey',
          type: 'post',
          success:function(res){
            if(res.code == 0){
              layer.msg(res.msg, {icon: 6});
              $('input[name="apiKey"]').val(res.data);
            }else{
              layer.msg(res.msg, {icon: 7});
            }
          }
       });
    },

  });

  // 指定开关事件
  form.on('switch(switch_up)', function(data){


    $.ajax({
      url:'/api/set/switch_headscale',
      type: 'post',
      data: {Switch:this.checked},
      dataType: 'json',
      success:function(res){
        if(res.code == 0){
          layer.msg(res.msg, {icon: 6});
        }else{
          layer.msg(res.msg, {icon: 7});
        }

      }
    });

  });


  // 提交事件
  form.on('submit(set_config)', function(data){
    var field = data.field; // 获取表单字段值

    console.log(field);

    $.ajax({
      url:'/api/set/upset',
      type: 'post',
      data:field,
      dataType: 'json',
      success:function(res){
        if(res.code == 0){
          layer.msg(res.msg, {icon: 6});
        }else{
          layer.msg(res.msg, {icon: 7});
        }

      }
    });

    return false; // 阻止默认 form 跳转
  });

});
</script>
</body>
</html>